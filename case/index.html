<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞</title>
<style>
:root{--bg:#0b0d12;--text:#f7f8fb;--accent:#ffd400}
*{box-sizing:border-box}
html,body{margin:0;min-height:100%;background:#0b0d12;color:var(--text);font-family:system-ui,-apple-system,"Futura PT",Inter,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
.page{max-width:520px;margin:0 auto;padding:14px 16px 80px;} /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –ø–æ–¥ –Ω–∞–≤–±–∞—Ä */

/* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
.top{display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center; z-index: 2; position: relative;}
.back{background:var(--accent);color:#171a1f;font-weight:900;border:none;border-radius:16px;padding:12px 16px;cursor:pointer}
.logo{height:32px}
.balance{background:var(--accent);color:#171a1f;font-weight:900;border-radius:999px;padding:8px 14px;display:flex;gap:8px}

.h1{font-weight:900;font-size:42px;margin:16px 2px 8px;text-align:center}

/* –°–µ—Ç–∫–∞ –∫–µ–π—Å–æ–≤ */
.grid{display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:8px}
.cell{
  position:relative;background:rgba(255,255,255,.03);border:none;border-radius:24px;
  padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden;
  aspect-ratio: 1/1; cursor:pointer; z-index: 1;
}
.crate{width:100%;height:100%;display:grid;place-items:center}
.crate img{width:92%;height:92%;object-fit:contain;transition:opacity .15s}
.hint{position:absolute;inset:0;display:grid;place-items:center;font-weight:900;background:rgba(0,0,0,.28);opacity:0;pointer-events:none;transition:.18s}
.cell.show-hint .hint{opacity:1}

.price-wrap{display:flex;justify-content:center;margin:24px 0 32px}
.price{background:var(--accent);color:#171a1f;padding:12px 24px;border-radius:16px;font-weight:900;font-size:18px;box-shadow:0 0 22px rgba(255,212,0,.35)}

/* === –í–ù–£–¢–†–ï–ù–ù–û–°–¢–ò –Ø–©–ò–ö–ê (–ü–†–ò–ó) === */
.cell-doors{
  position:absolute;inset:14px;
  background:#0a0c12;border:1px solid #1b2130;border-radius:18px;overflow:hidden; pointer-events: none;
}
.cell-door{position:absolute;top:8%;bottom:8%;width:50%;background:linear-gradient(180deg,#ffc400,#e2ae00); z-index: 2;}
.cell-door.l{left:0;transform-origin:left center}
.cell-door.r{right:0;transform-origin:right center}

.cell.open .cell-door.l{transform:perspective(800px) rotateY(-85deg); transition: transform 0.4s ease;}
.cell.open .cell-door.r{transform:perspective(800px) rotateY(85deg); transition: transform 0.4s ease;}

/* –ö–æ–Ω—Ç–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —è—â–∏–∫–∞ */
.prize-box {
  position: absolute; inset: 0; 
  display: flex; flex-direction: column; 
  align-items: center; justify-content: center;
  z-index: 1; /* –ü–æ–¥ –¥–≤–µ—Ä—è–º–∏, –Ω–æ –Ω–∞–¥ –¥–Ω–æ–º */
  pointer-events: auto; /* –ß—Ç–æ–±—ã –∫–ª–∏–∫–∞—Ç—å –∫–Ω–æ–ø–∫–∏ */
}
.prize-box img {
  width: 60%; height: 60%; object-fit: contain; 
  filter: drop-shadow(0 0 15px rgba(255, 212, 0, 0.4));
  margin-bottom: 4px;
}
.prize-title {
  font-size: 11px; font-weight: 900; color: #fff; text-align: center;
  line-height: 1.1; margin-bottom: 6px;
}
.prize-actions {
  display: flex; gap: 4px; width: 100%; padding: 0 4px;
}
.prize-btn {
  flex: 1; border: none; border-radius: 6px;
  padding: 6px 0; font-size: 10px; font-weight: 800;
  cursor: pointer; text-transform: uppercase;
}
.btn-take { background: var(--accent); color: #171a1f; }
.btn-sell-mini { background: #2c313f; color: #a5abb8; border: 1px solid #3e4554; }


/* === FULL SCREEN OVERLAY === */
.overlay {
  position: fixed; inset: 0; 
  background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
  z-index: 9999;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
}
.overlay.show { opacity: 1; pointer-events: auto; }

.close-overlay-btn {
  position: absolute; top: 24px; right: 24px;
  background: rgba(255, 255, 255, 0.1); border: none; color: #fff;
  font-size: 32px; line-height: 1; width: 44px; height: 44px;
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  cursor: pointer; z-index: 10001; transition: background 0.2s, transform 0.2s;
  padding-bottom: 4px; 
}
.close-overlay-btn:hover { background: rgba(255, 255, 255, 0.2); transform: scale(1.1); }
.close-overlay-btn:active { transform: scale(0.95); }

.rays {
  position: absolute; width: 600px; height: 600px;
  background: conic-gradient(from 0deg, transparent 0deg, rgba(255, 212, 0, 0.2) 20deg, transparent 40deg, rgba(255, 212, 0, 0.2) 60deg, transparent 80deg, rgba(255, 212, 0, 0.2) 100deg, transparent 120deg, rgba(255, 212, 0, 0.2) 140deg, transparent 160deg, rgba(255, 212, 0, 0.2) 180deg, transparent 200deg, rgba(255, 212, 0, 0.2) 220deg, transparent 240deg, rgba(255, 212, 0, 0.2) 260deg, transparent 280deg, rgba(255, 212, 0, 0.2) 300deg, transparent 320deg, rgba(255, 212, 0, 0.2) 340deg, transparent 360deg);
  animation: spin 10s linear infinite;
  z-index: -1; pointer-events: none;
}
@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

.overlay-card {
  transform: scale(0.5); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  display: flex; flex-direction: column; align-items: center;
}
.overlay.show .overlay-card { transform: scale(1); }

.overlay-img {
  width: 220px; height: 220px; object-fit: contain;
  filter: drop-shadow(0 0 30px rgba(255, 212, 0, 0.6));
  margin-bottom: 20px;
}
.overlay-title {
  font-size: 32px; font-weight: 900; text-transform: uppercase;
  text-shadow: 0 4px 20px rgba(0,0,0,0.8); margin-bottom: 30px;
}

.actions { display: flex; flex-direction: column; gap: 12px; width: 280px; }
.act-btn {
  border: none; padding: 16px; border-radius: 16px;
  font-size: 18px; font-weight: 900; cursor: pointer;
  text-transform: uppercase; width: 100%; transition: transform 0.1s;
}
.act-btn:active { transform: scale(0.97); }
.btn-sell { background: var(--accent); color: #111; box-shadow: 0 0 20px rgba(255,212,0,0.4); }
.btn-keep { background: #2c313f; color: #fff; border: 1px solid #3e4554; }

.loader { display:none; width: 48px; height: 48px; border: 5px solid #FFF; border-bottom-color: transparent; border-radius: 50%; animation: rotation 1s linear infinite; margin-bottom: 20px;}
.loader.show { display: inline-block; }
@keyframes rotation { 0% { transform: rotate(0deg) } 100% { transform: rotate(360deg) } }

.prize-item {
  background: #0b0d12; border-radius: 16px; padding: 10px;
  display: flex; flex-direction: column; align-items: center; text-align: center;
  border: 1px solid #232838; position: relative;
}
.prize-item.rare { border-color: var(--accent); box-shadow: 0 0 10px rgba(255, 212, 0, 0.15); }
.prize-img { width: 48px; height: 48px; object-fit: contain; margin-bottom: 8px; }
.prize-name { font-size: 11px; font-weight: 700; color: #a5abb8; line-height: 1.2; }
.rare-badge {
  position: absolute; top: -6px; right: -6px; background: var(--accent); color: #000;
  font-size: 9px; font-weight: 900; padding: 2px 6px; border-radius: 8px;
}

/* –ù–∞–≤–∏–≥–∞—Ü–∏—è (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è) */
.nav {
  position: fixed; bottom: 0; left: 0; right: 0;
  background: rgba(11,13,18,0.95); backdrop-filter: blur(10px);
  border-top: 1px solid #1f232e;
  padding: 12px 16px 24px;
  display: flex; justify-content: space-around;
  z-index: 100;
}
.nav .btn {
  color: #5d6470; text-decoration: none; font-weight: 800; font-size: 14px;
  display: flex; flex-direction: column; align-items: center; gap: 4px;
}
.nav .btn.active { color: var(--accent); }

</style>
</head>
<body>
<div class="page">
  <div class="top">
    <button class="back" onclick="location.href='/'">‚Üê –ù–∞–∑–∞–¥</button>
    <img class="logo" src="/assets/logo.png" alt="LAMBO DROP">
    <div class="balance">‚òÖ <span id="bal">...</span></div>
  </div>

  <div id="caseTitle" class="h1">–ö–µ–π—Å</div>
  <div id="grid" class="grid"></div>
  <div class="price-wrap"><div id="price" class="price">‚òÖ 0</div></div>

  <div class="prizes-section" style="margin-top:20px; background:#151921; border-radius:24px; padding:20px; border:1px solid #232838;">
    <div style="text-align:center; font-weight:800; margin-bottom:16px; color:#fff">–°–û–î–ï–†–ñ–ò–ú–û–ï –ö–ï–ô–°–ê</div>
    <div id="prizesList" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(80px, 1fr)); gap:12px;">
       <div style="grid-column: 1/-1; text-align: center; color: #555; font-size: 13px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
  </div>

  <nav class="nav">
    <a class="btn active" href="/">–ö–µ–π—Å—ã</a>
    <a class="btn" href="/crash.html">Crash üöÄ</a>
    <a class="btn" href="/profile/">–ü—Ä–æ—Ñ–∏–ª—å</a>
  </nav>
</div>

<div id="overlay" class="overlay">
  <button id="btnCloseOverlay" class="close-overlay-btn">&times;</button>
  
  <div class="rays"></div>
  <div class="loader" id="loader"></div>

  <div class="overlay-card" id="cardResult" style="display:none">
    <img id="winImg" class="overlay-img" src="">
    <div id="winTitle" class="overlay-title">PRIZE NAME</div>
    
    <div class="actions">
      <button id="btnSell" class="act-btn btn-sell">–ü—Ä–æ–¥–∞—Ç—å (+100)</button>
      <button id="btnKeep" class="act-btn btn-keep">–û—Å—Ç–∞–≤–∏—Ç—å –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ</button>
    </div>
  </div>
</div>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
const qs=s=>document.querySelector(s);
const tg = window.Telegram.WebApp;
tg.ready(); tg.expand();
const vib=(t=15)=>('vibrate'in navigator)&&navigator.vibrate(t);

// --- –ö–û–ù–§–ò–ì ---
function getCaseId(){
  const urlId=(new URLSearchParams(location.search)).get('case');
  return urlId ? urlId.toLowerCase() : 'jiga';
}
const caseId=getCaseId();

const ASSETS={
  jiga:{title:'–ñ–∏–≥–∞', price:209, stages:['/assets/Case Lada P1.png', '/assets/Case Lada P2.png', '/assets/Case Lada P3.png']},
  camry:{title:'–ö–∞–º—Ä–∏', price:629, stages:['/assets/Case Cam P1.png', '/assets/Case Cam P2.png', '/assets/Case Cam P3.png']},
  bmw:{title:'–ë—ç—Ö–∞', price:1499, stages:['/assets/Case BMW P1.png', '/assets/Case BMW P2.png', '/assets/Case BMW P3.png']},
  lambo:{title:'–õ–∞–º–±–æ', price:3899, stages:['/assets/Case Lambo P1.png', '/assets/Case Lambo P2.png', '/assets/Case Lambo P3.png']}
};
const conf=ASSETS[caseId]||ASSETS.jiga;
qs('#caseTitle').textContent=conf.title;
qs('#price').textContent=`‚òÖ ${conf.price}`;

// --- –≠–õ–ï–ú–ï–ù–¢–´ –û–í–ï–†–õ–ï–Ø ---
const overlay = qs('#overlay');
const btnCloseOverlay = qs('#btnCloseOverlay');
const loader = qs('#loader');
const cardResult = qs('#cardResult');
const winImg = qs('#winImg');
const winTitle = qs('#winTitle');
const btnSell = qs('#btnSell');
const btnKeep = qs('#btnKeep');

// –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π –≤ –æ–≤–µ—Ä–ª–µ–µ
let currentWin = null; 

// --- –°–ï–¢–ö–ê ---
const grid=qs('#grid');
for(let i=0;i<4;i++){
  const cell=document.createElement('button');
  cell.className='cell';
  cell.dataset.stage='0';
  cell.innerHTML=`<div class="crate"><img src="${conf.stages[0]}"></div><div class="hint">–ñ–ú–ò</div>`;
  grid.appendChild(cell);
}

// --- –ö–õ–ò–ö –ü–û –Ø–©–ò–ö–£ ---
grid.addEventListener('click', async (e)=>{
  const cell=e.target.closest('.cell'); 
  // –ï—Å–ª–∏ —è—â–∏–∫ —É–∂–µ –æ—Ç–∫—Ä—ã—Ç (–≤–∏–¥–µ–Ω –ø—Ä–∏–∑) –∏–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∞–Ω–∏–º–∞—Ü–∏–∏ ‚Äî –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ –∫–ª–∏–∫ –ø–æ –Ω–µ–º—É
  if(!cell || cell.classList.contains('open') || cell.classList.contains('processing')) return;
  
  vib(12);
  let stage = +cell.dataset.stage;
  const img = cell.querySelector('.crate img');

  // –≠—Ç–∞–ø—ã 0-1: –ø—Ä–æ—Å—Ç–æ –∫–ª–∏–∫–∞–µ–º (—Ä–∞–∑–æ–≥—Ä–µ–≤)
  if(stage < 2){
    cell.classList.add('show-hint'); 
    setTimeout(()=>cell.classList.remove('show-hint'), 260);
    stage += 1; img.src = conf.stages[stage]; cell.dataset.stage = String(stage);
    return;
  }

  // –≠—Ç–∞–ø 2 -> 3: –û–¢–ö–†–´–¢–ò–ï
  cell.classList.add('processing'); 
  cell.dataset.stage = '3';
  img.style.opacity = '0'; // –°–∫—Ä—ã–≤–∞–µ–º —è—â–∏–∫

  // –î–æ–±–∞–≤–ª—è–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (–¥–≤–µ—Ä–∏ + –º–∏–Ω–∏-–≤–µ—Ä—Å–∏—è –ø—Ä–∏–∑–∞)
  const doors = document.createElement('div');
  doors.className = 'cell-doors';
  doors.innerHTML = `
    <div class="cell-door l"></div>
    <div class="cell-door r"></div>
    <div class="prize-box">
      <img id="pimg" src="/assets/prizes/sample.png">
      <div class="prize-title" id="ptitle">...</div>
      <div class="prize-actions">
         <button class="prize-btn btn-sell-mini" id="psell">–ü—Ä–æ–¥–∞—Ç—å</button>
         <button class="prize-btn btn-take" id="ptake">–ó–∞–±—Ä–∞—Ç—å</button>
      </div>
    </div>
  `;
  cell.appendChild(doors);

  // 1. –ê–Ω–∏–º–∞—Ü–∏—è –¥–≤–µ—Ä–µ–π (CSS)
  cell.classList.add('open'); 

  // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –≤ –æ–≤–µ—Ä–ª–µ–µ
  setTimeout(() => {
    overlay.classList.add('show');
    loader.classList.add('show');
    cardResult.style.display = 'none';
    btnCloseOverlay.style.display = 'none'; // –ü–æ–∫–∞ –≥—Ä—É–∑–∏–º, –∫—Ä–µ—Å—Ç–∏–∫ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
  }, 300);

  // 3. –ó–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
  try {
    const res = await fetch('/api/open', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'X-Telegram-Data': tg.initData },
      body: JSON.stringify({ caseId })
    }).then(r => r.json());

    loader.classList.remove('show');

    if (res.error) {
      tg.showAlert(res.error);
      resetOverlay();
      resetCell(cell, img, doors); // –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å—ë
      return;
    }

    // –£—Å–ø–µ—Ö!
    if (res.stars != null) qs('#bal').textContent = res.stars;
    
    // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–∑–∞
    const p = res.prize;
    const sellPrice = Math.floor(p.value); // 100% —Ü–µ–Ω–∞

    // -- –ó–∞–ø–æ–ª–Ω—è–µ–º –û–í–ï–†–õ–ï–ô --
    winImg.src = p.image;
    winTitle.textContent = p.title;
    btnSell.textContent = `–ü–†–û–î–ê–¢–¨ (+${sellPrice} ‚òÖ)`;
    
    cardResult.style.display = 'flex';
    btnCloseOverlay.style.display = 'flex'; // –ú–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å
    tg.HapticFeedback.notificationOccurred('success');

    // -- –ó–∞–ø–æ–ª–Ω—è–µ–º –ú–ò–ù–ò-–Ø–ß–ï–ô–ö–£ (–Ω–∞ —Ñ–æ–Ω–µ) --
    doors.querySelector('#pimg').src = p.image;
    doors.querySelector('#ptitle').textContent = p.title;
    doors.querySelector('#psell').textContent = `+${sellPrice}`;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫ –æ–≤–µ—Ä–ª–µ—è
    currentWin = {
      inventoryId: res.inventoryId,
      sellPrice: sellPrice,
      cell: cell,
      img: img,
      doors: doors
    };

    // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ú–ò–ù–ò-–ö–ù–û–ü–û–ö (–í –Ø–ß–ï–ô–ö–ï) ---
    // 1. –ú–∏–Ω–∏-–ó–∞–±—Ä–∞—Ç—å (–û—á–∏—Å—Ç–∏—Ç—å —è—á–µ–π–∫—É)
    doors.querySelector('#ptake').onclick = (ev) => {
      ev.stopPropagation(); 
      resetCell(cell, img, doors);
    };

    // 2. –ú–∏–Ω–∏-–ü—Ä–æ–¥–∞—Ç—å
    doors.querySelector('#psell').onclick = async (ev) => {
      ev.stopPropagation();
      const btn = ev.target;
      btn.textContent = '...';
      await sellItem(currentWin.inventoryId, sellPrice);
      resetCell(cell, img, doors);
    };

  } catch (err) {
    console.error(err);
    tg.showAlert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏");
    resetOverlay();
    resetCell(cell, img, doors);
  }
});

// --- –õ–û–ì–ò–ö–ê –û–í–ï–†–õ–ï–Ø ---

// 1. –ü–†–û–î–ê–¢–¨ (–í –æ–≤–µ—Ä–ª–µ–µ) -> –ó–∞–∫—Ä—ã—Ç—å –æ–≤–µ—Ä–ª–µ–π + –°–±—Ä–æ—Å–∏—Ç—å —è—á–µ–π–∫—É
btnSell.onclick = async () => {
  if(!currentWin) return;
  btnSell.textContent = '...';
  
  await sellItem(currentWin.inventoryId, currentWin.sellPrice);
  
  resetCell(currentWin.cell, currentWin.img, currentWin.doors);
  resetOverlay();
  currentWin = null;
};

// 2. –û–°–¢–ê–í–ò–¢–¨ (–í –æ–≤–µ—Ä–ª–µ–µ) -> –¢–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—å –æ–≤–µ—Ä–ª–µ–π
btnKeep.onclick = () => {
  resetOverlay();
  // –Ø—á–µ–π–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π!
};

// 3. –ó–ê–ö–†–´–¢–¨ –ö–†–ï–°–¢–ò–ö–û–ú -> –¢–æ–ª—å–∫–æ –∑–∞–∫—Ä—ã—Ç—å –æ–≤–µ—Ä–ª–µ–π
btnCloseOverlay.onclick = () => {
   vib(10);
   resetOverlay();
};

// --- –§–£–ù–ö–¶–ò–ò ---

async function sellItem(invId, price) {
  try {
    const res = await fetch('/api/sell', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'X-Telegram-Data': tg.initData },
      body: JSON.stringify({ itemId: invId })
    }).then(r => r.json());

    if(res.success) {
      qs('#bal').textContent = res.balance;
      tg.showAlert(`–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ${res.added} –∑–≤–µ–∑–¥!`);
    } else {
      tg.showAlert(res.error || '–û—à–∏–±–∫–∞');
    }
  } catch(e) { console.error(e); }
}

function resetOverlay() {
  overlay.classList.remove('show');
  loader.classList.remove('show');
  cardResult.style.display = 'none';
  btnCloseOverlay.style.display = 'none';
  btnSell.textContent = '–ü–†–û–î–ê–¢–¨'; 
}

function resetCell(cell, img, doors) {
  cell.classList.remove('open', 'processing');
  if(doors) doors.remove();
  
  cell.dataset.stage = '0';
  img.src = conf.stages[0];
  img.style.opacity = '1';
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–∑–æ–≤ (—Å–Ω–∏–∑—É)
fetch(`/api/case-items?caseId=${caseId}`).then(r=>r.json()).then(items=>{
  const list = qs('#prizesList');
  list.innerHTML = '';
  if(items.length === 0) {
      list.innerHTML = '<div style="color:#777; grid-column:1/-1; text-align:center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>';
      return;
  }
  items.forEach(item => {
      const el = document.createElement('div');
      el.className = `prize-item ${item.is_rare ? 'rare' : ''}`;
      el.innerHTML = `
        ${item.is_rare ? '<div class="rare-badge">RARE</div>' : ''}
        <img class="prize-img" src="${item.image_url}" onerror="this.src='/assets/prizes/sample.png'">
        <div class="prize-name">${item.name}</div>
      `;
      list.appendChild(el);
  });
});

// –ë–∞–ª–∞–Ω—Å
fetch('/api/profile', {headers:{'X-Telegram-Data':tg.initData}})
  .then(r=>r.ok?r.json():null).then(d=>{if(d?.stars!=null)qs('#bal').textContent=d.stars}).catch(()=>{});

</script>
</body>
</html>
