<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>Lambo Drop</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="/styles.css">
  
  <style>
    /* === 1. –ñ–ï–°–¢–ö–ò–ô FULLSCREEN FIX === */
    html {
      background: #0b0d12; /* –¶–≤–µ—Ç —Ñ–æ–Ω–∞ –ø–æ–¥–ª–æ–∂–∫–∏ */
    }
    body {
      margin: 0; padding: 0;
      width: 100vw; height: 100vh;
      overflow: hidden; /* –ó–∞–ø—Ä–µ—â–∞–µ–º —Å–∫—Ä–æ–ª–ª body */
      background: #0b0d12;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      /* –£—á–∏—Ç—ã–≤–∞–µ–º Safe Area –¥–ª—è iPhone —Å —á–µ–ª–∫–æ–π/–æ—Å—Ç—Ä–æ–≤–æ–º */
      padding-top: env(safe-area-inset-top); 
    }

    .container {
      width: 100%; height: 100%;
      overflow-y: auto; /* –°–∫—Ä–æ–ª–ª —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
      -webkit-overflow-scrolling: touch;
      display: flex; flex-direction: column;
      /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –Ω–∞–≤–±–∞—Ä–∞ + Safe Area */
      padding-bottom: calc(90px + env(safe-area-inset-bottom));
    }

    /* === –°–¢–ò–õ–ò LIVE –õ–ï–ù–¢–´ === */
    .live-bar {
      height: 64px; background: #111319;
      border-top: 1px solid #1f232e; border-bottom: 1px solid #1f232e;
      display: flex; align-items: center; overflow: hidden; position: relative;
      margin-bottom: 10px; flex-shrink: 0;
    }
    .live-label {
      background: #ffd400; color: #000; font-weight: 900; font-size: 12px;
      padding: 0 10px; height: 100%; display: flex; align-items: center; justify-content: center;
      position: absolute; left: 0; top: 0; bottom: 0; z-index: 10;
      box-shadow: 4px 0 15px rgba(0,0,0,0.5);
    }
    .live-label span { writing-mode: vertical-rl; transform: rotate(180deg); }
    .live-track { display: flex; gap: 8px; padding-left: 40px; will-change: transform; }
    .live-track.animate { animation: scrollLive 25s linear infinite; }
    .live-item {
      width: 50px; height: 50px; background: #1a1d26; border-radius: 10px; border: 1px solid #2f3542;
      flex-shrink: 0; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden;
    }
    .live-item.rare { border: 1px solid #ffd400; box-shadow: 0 0 10px rgba(255, 212, 0, 0.4); }
    .live-item img { width: 80%; height: 80%; object-fit: contain; z-index: 1; }
    @keyframes scrollLive { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

    /* === 2. –ö–ù–û–ü–ö–ê (i) –ò –ú–û–î–ê–õ–ö–ê === */
    .info-btn {
      position: absolute;
      /* –ß—É—Ç—å –±–æ–ª—å—à–µ –æ—Ç—Å—Ç—É–ø, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–∏–ª–∏–ø–∞–ª–æ –∫ –∫—Ä–∞—é –Ω–∞ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
      left: 12px; top: 12px; 
      width: 28px; height: 28px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      color: #fff;
      font-weight: 700;
      font-size: 14px;
      display: flex; align-items: center; justify-content: center;
      z-index: 20;
      backdrop-filter: blur(4px);
      cursor: pointer;
      /* –£–≤–µ–ª–∏—á–∏–º –∑–æ–Ω—É –∫–ª–∏–∫–∞ */
      touch-action: manipulation;
    }
    .info-btn:active { transform: scale(0.95); background: #ffd400; color: #000; border-color: #ffd400; }

    /* –ú–æ–¥–∞–ª–∫–∞ */
    .modal-overlay {
      position: fixed; inset: 0; z-index: 10000;
      background: rgba(0, 0, 0, 0.8); /* –¢–µ–º–Ω–µ–µ —Ñ–æ–Ω */
      backdrop-filter: blur(5px);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: 0.2s ease;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }

    .modal-card {
      background: #181b22;
      width: 85%; max-width: 320px;
      padding: 24px 20px;
      border-radius: 24px;
      border: 1px solid #2f3542;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0,0,0,0.8);
      transform: scale(0.95); transition: 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .modal-overlay.open .modal-card { transform: scale(1); }

    .modal-badge {
      display: inline-block; background: #ffd400; color: #000;
      font-weight: 900; font-size: 10px; padding: 4px 8px; text-transform: uppercase;
      border-radius: 6px; margin-bottom: 12px;
    }
    .modal-title { margin: 0 0 10px; font-size: 18px; font-weight: 800; color: #fff; line-height: 1.2; }
    .modal-text { color: #a5abb8; font-size: 14px; line-height: 1.5; margin-bottom: 20px; }
    .modal-text b { color: #fff; font-weight: 700; }
    
    .modal-close-btn {
      width: 100%; background: #2f3542; color: #fff; border: none;
      padding: 12px; border-radius: 14px; font-weight: 700; font-size: 15px;
    }
    .modal-close-btn:active { background: #3a4150; transform: scale(0.98); }
  </style>
</head>
<body>

  <div class="modal-overlay" id="infoModal">
    <div class="modal-card">
      <div class="modal-badge">–ì–∞—Ä–∞–Ω—Ç</div>
      <h3 class="modal-title">–ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–´–ô –û–ö–£–ü</h3>
      <p class="modal-text">
        –í <b>–º–∏–Ω–∏–º—É–º</b> –æ–¥–Ω–æ–º –∏–∑ 4 –∫–µ–π—Å–æ–≤ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ª–µ–∂–∏—Ç –ø—Ä–µ–¥–º–µ—Ç, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–π —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–µ–π—Å–∞!
      </p>
      <button class="modal-close-btn" onclick="closeInfo()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <div class="container">
    <header class="header">
      <img class="logo" src="/assets/logo.png" alt="LAMBO DROP" style="height:38px;">
      
      <a class="balance" href="/topup/" style="text-decoration: none; color: #171a1f;">
        <span class="star">‚òÖ</span>
        <span class="value" id="balanceValue">...</span> 
      </a>
    </header>

    <section class="live-bar">
      <div class="live-label"><span>LIVE</span></div>
      <div class="live-track" id="liveTrack">
          <div style="padding:22px; color:#555; font-size:10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
    </section>

    <main class="grid">
      <a class="card gray" data-caseid="jiga" href="/case/?case=jiga" aria-label="–ñ–∏–≥–∞" style="--w:150%; --top:-48px; --left:49%;">
        <div class="art"><img src="/assets/case-1.png" alt="–ñ–∏–≥–∞"></div>
        <div class="title">–ñ–∏–≥–∞</div><div class="price"><span class="star">‚òÖ</span> 209</div>
      </a>

      <a class="card green" data-caseid="camry" href="/case/?case=camry" aria-label="–ö–∞–º—Ä–∏" style="--w:152%; --top:-54px; --left:52%;">
        <div class="art"><img src="/assets/case-2.png" alt="–ö–∞–º—Ä–∏"></div>
        <div class="title">–ö–∞–º—Ä–∏</div><div class="price"><span class="star">‚òÖ</span> 629</div>
      </a>

      <a class="card red" data-caseid="bmw" href="/case/?case=bmw" aria-label="–ë—ç—Ö–∞" style="--w:158%; --top:-52px; --left:51%;">
        <div class="info-btn" onclick="openInfo(event)">i</div>
        <div class="art"><img src="/assets/case-3.png" alt="–ë—ç—Ö–∞"></div>
        <div class="title">–ë—ç—Ö–∞</div><div class="price"><span class="star">‚òÖ</span> 1499</div>
      </a>

      <a class="card yellow" data-caseid="lambo" href="/case/?case=lambo" aria-label="–õ–∞–º–±–æ" style="--w:160%; --top:-64px; --left:53%;">
        <div class="info-btn" onclick="openInfo(event)">i</div>
        <div class="art"><img src="/assets/case-4.png" alt="–õ–∞–º–±–æ"></div>
        <div class="title">–õ–∞–º–±–æ</div><div class="price"><span class="star">‚òÖ</span> 3899</div>
      </a>
    </main>

    <div class="nav-spacer" aria-hidden="true" style="height: 20px;"></div>

    <nav class="nav">
      <a class="btn active" href="/">–ö–µ–π—Å—ã</a>
      <a class="btn" href="/crash.html">Crash üöÄ</a>
      <a class="btn" href="/profile/">–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>
  </div>

  <script>
  // === 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø TELEGRAM (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï) ===
  const tg = window.Telegram.WebApp;

  function initApp() {
      // –°–æ–æ–±—â–∞–µ–º —Ç–µ–ª–µ–≥—Ä–∞–º—É, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ
      tg.ready();

      // 1. –ü—ã—Ç–∞–µ–º—Å—è –≤–∫–ª—é—á–∏—Ç—å –ü–û–õ–ù–û–≠–ö–†–ê–ù–ù–´–ô –†–ï–ñ–ò–ú (–Ω–æ–≤—ã–π API)
      // –≠—Ç–æ —É–±–µ—Ä–µ—Ç –∑–∞–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ —É–≥–ª—ã —à—Ç–æ—Ä–∫–∏
      try {
          if (tg.requestFullscreen) {
              tg.requestFullscreen();
          } else {
              // –§–æ–ª–±–µ–∫ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
              tg.expand();
          }
      } catch (e) {
          tg.expand();
      }

      // 2. –ö–†–ê–°–ò–ú –®–ê–ü–ö–£ –í –¶–í–ï–¢ –§–û–ù–ê
      // –ß—Ç–æ–±—ã –≤–µ—Ä—Ö–Ω—è—è –ø–æ–ª–æ—Å–∫–∞ "–ó–∞–∫—Ä—ã—Ç—å" —Å–ª–∏–ª–∞—Å—å —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
      try {
          tg.setHeaderColor('#0b0d12'); 
          tg.setBackgroundColor('#0b0d12');
      } catch (e) {}
      
      // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      // tg.enableClosingConfirmation();
  }

  // –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É –∏ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —á–µ—Ä–µ–∑ 100–º—Å (–¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –Ω–∞ Android)
  initApp();
  setTimeout(initApp, 100);


  // === 2. –õ–û–ì–ò–ö–ê –ú–û–î–ê–õ–ö–ò ===
  function openInfo(e) {
    e.preventDefault(); 
    e.stopPropagation();
    document.getElementById('infoModal').classList.add('open');
    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
  }

  function closeInfo() {
    document.getElementById('infoModal').classList.remove('open');
  }
  
  document.getElementById('infoModal').addEventListener('click', function(e) {
    if(e.target === this) closeInfo();
  });


  // === 3. –î–ê–ù–ù–´–ï (–ë–ê–õ–ê–ù–° + LIVE) ===
  (async () => {
    const balEl = document.getElementById('balanceValue');

    // –ë–∞–ª–∞–Ω—Å
    try {
        const res = await fetch('/api/user?action=auth', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ initData: tg.initData })
        }).then(r => r.json());

        if (res.ok && res.stars != null) balEl.textContent = res.stars;
        else balEl.textContent = '0';
    } catch (e) {
        balEl.textContent = '?';
    }

    // Live –ª–µ–Ω—Ç–∞
    async function loadLiveFeed() {
      const track = document.getElementById('liveTrack');
      try {
        const drops = await fetch('/api/live').then(r => r.json());
        if(!drops || !drops.length) {
           track.innerHTML = '<div style="padding:22px; color:#555; font-size:10px;">–õ–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞</div>';
           return;
        }
        const itemsHtml = drops.map(d => `
          <div class="live-item ${d.is_rare ? 'rare' : ''}">
             <img src="${d.image_url}" onerror="this.src='/assets/logo.png'">
          </div>
        `).join('');
        track.innerHTML = itemsHtml + itemsHtml; 
        track.classList.add('animate');
      } catch(e) {
        track.innerHTML = '<div style="padding:22px; color:#555; font-size:10px;">Offline</div>';
      }
    }
    loadLiveFeed();
  })();
  </script>
</body>
</html>
