<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>Lambo Drop ‚Äî Gift Wins</title>
  <link rel="stylesheet" href="/styles.css">
  
  <style>
    /* === 1. FULLSCREEN FIX (–ß–¢–û–ë–´ –ù–ï –ë–´–õ–û –ü–†–£–ñ–ò–ù–´ –ù–ê IOS) === */
    html, body {
      margin: 0; padding: 0;
      width: 100%; height: 100%;
      overflow: hidden; /* –ë–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
      position: fixed; /* –§–∏–∫—Å–∏—Ä—É–µ–º —Ñ–æ–Ω */
      background: #0b0d12;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    .container {
      width: 100%; height: 100%;
      overflow-y: auto; /* –°–∫—Ä–æ–ª–ª –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
      -webkit-overflow-scrolling: touch;
      display: flex; flex-direction: column;
      padding-bottom: 90px; /* –ú–µ—Å—Ç–æ –ø–æ–¥ –º–µ–Ω—é */
    }

    /* === –°–¢–ò–õ–ò LIVE –õ–ï–ù–¢–´ === */
    .live-bar {
      height: 64px; background: #111319;
      border-top: 1px solid #1f232e; border-bottom: 1px solid #1f232e;
      display: flex; align-items: center; overflow: hidden; position: relative;
      margin-bottom: 10px; flex-shrink: 0;
    }
    .live-label {
      background: #ffd400; color: #000; font-weight: 900; font-size: 12px;
      padding: 0 10px; height: 100%; display: flex; align-items: center; justify-content: center;
      position: absolute; left: 0; top: 0; bottom: 0; z-index: 10;
      box-shadow: 4px 0 15px rgba(0,0,0,0.5);
    }
    .live-label span { writing-mode: vertical-rl; transform: rotate(180deg); }
    .live-track { display: flex; gap: 8px; padding-left: 40px; will-change: transform; }
    .live-track.animate { animation: scrollLive 25s linear infinite; }
    .live-item {
      width: 50px; height: 50px; background: #1a1d26; border-radius: 10px; border: 1px solid #2f3542;
      flex-shrink: 0; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden;
    }
    .live-item.rare { border: 1px solid #ffd400; box-shadow: 0 0 10px rgba(255, 212, 0, 0.4); }
    .live-item img { width: 80%; height: 80%; object-fit: contain; z-index: 1; }
    @keyframes scrollLive { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

    /* === 2. –°–¢–ò–õ–ò –î–õ–Ø –ò–ù–§–û-–ö–ù–û–ü–ö–ò –ò –ú–û–î–ê–õ–ö–ò === */
    
    /* –ö–Ω–æ–ø–∫–∞ (i) –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ */
    .info-btn {
      position: absolute;
      left: 10px; top: 10px; /* –í –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É */
      width: 28px; height: 28px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      color: #fff;
      font-weight: 700;
      font-size: 14px;
      display: flex; align-items: center; justify-content: center;
      z-index: 20;
      backdrop-filter: blur(4px);
      cursor: pointer;
    }
    .info-btn:active { transform: scale(0.9); background: #ffd400; color: #000; }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (—Ñ–æ–Ω) */
    .modal-overlay {
      position: fixed; inset: 0; z-index: 10000;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(8px);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: 0.3s;
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }

    /* –ö–æ–Ω—Ç–µ–Ω—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
    .modal-card {
      background: #181b22;
      width: 90%; max-width: 340px;
      padding: 24px 20px;
      border-radius: 24px;
      border: 1px solid #2f3542;
      text-align: center;
      box-shadow: 0 20px 50px rgba(0,0,0,0.8);
      transform: scale(0.9); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .modal-overlay.open .modal-card { transform: scale(1); }

    .modal-badge {
      display: inline-block; background: #ffd400; color: #000;
      font-weight: 900; font-size: 11px; padding: 4px 10px;
      border-radius: 8px; margin-bottom: 12px;
    }
    .modal-title { margin: 0 0 12px; font-size: 20px; font-weight: 800; color: #fff; line-height: 1.2; }
    .modal-text { color: #a5abb8; font-size: 15px; line-height: 1.5; margin-bottom: 24px; }
    .modal-text b { color: #fff; font-weight: 900; }
    
    .modal-close-btn {
      width: 100%; background: #2f3542; color: #fff; border: none;
      padding: 14px; border-radius: 16px; font-weight: 700; font-size: 16px;
    }
    .modal-close-btn:active { opacity: 0.8; transform: scale(0.98); }
  </style>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>

  <div class="modal-overlay" id="infoModal">
    <div class="modal-card">
      <div class="modal-badge">–ì–ê–†–ê–ù–¢</div>
      <h3 class="modal-title">–ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–´–ô –û–ö–£–ü</h3>
      <p class="modal-text">
        –í <b>–º–∏–Ω–∏–º—É–º</b> –æ–¥–Ω–æ–º –∏–∑ 4 –∫–µ–π—Å–æ–≤ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ª–µ–∂–∏—Ç –ø—Ä–µ–¥–º–µ—Ç –ø—Ä–µ–≤—ã—à–∞—é—â–∏–π —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–µ–π—Å–∞!
      </p>
      <button class="modal-close-btn" onclick="closeInfo()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <div class="container">
    <header class="header">
      <img class="logo" src="/assets/logo.png" alt="LAMBO DROP" style="height:38px;">
      
      <a class="balance" href="/topup/" style="text-decoration: none; color: #171a1f;">
        <span class="star">‚òÖ</span>
        <span class="value" id="balanceValue">...</span> 
      </a>
    </header>

    <section class="live-bar">
      <div class="live-label"><span>LIVE</span></div>
      <div class="live-track" id="liveTrack">
          <div style="padding:22px; color:#555; font-size:10px;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
    </section>

    <main class="grid">
      <a class="card gray" data-caseid="jiga" href="/case/?case=jiga" aria-label="–ñ–∏–≥–∞" style="--w:150%; --top:-48px; --left:49%;">
        <div class="art"><img src="/assets/case-1.png" alt="–ñ–∏–≥–∞"></div>
        <div class="title">–ñ–∏–≥–∞</div><div class="price"><span class="star">‚òÖ</span> 209</div>
      </a>

      <a class="card green" data-caseid="camry" href="/case/?case=camry" aria-label="–ö–∞–º—Ä–∏" style="--w:152%; --top:-54px; --left:52%;">
        <div class="art"><img src="/assets/case-2.png" alt="–ö–∞–º—Ä–∏"></div>
        <div class="title">–ö–∞–º—Ä–∏</div><div class="price"><span class="star">‚òÖ</span> 629</div>
      </a>

      <a class="card red" data-caseid="bmw" href="/case/?case=bmw" aria-label="–ë—ç—Ö–∞" style="--w:158%; --top:-52px; --left:51%;">
        <div class="info-btn" onclick="openInfo(event)">i</div>
        
        <div class="art"><img src="/assets/case-3.png" alt="–ë—ç—Ö–∞"></div>
        <div class="title">–ë—ç—Ö–∞</div><div class="price"><span class="star">‚òÖ</span> 1499</div>
      </a>

      <a class="card yellow" data-caseid="lambo" href="/case/?case=lambo" aria-label="–õ–∞–º–±–æ" style="--w:160%; --top:-64px; --left:53%;">
        <div class="info-btn" onclick="openInfo(event)">i</div>

        <div class="art"><img src="/assets/case-4.png" alt="–õ–∞–º–±–æ"></div>
        <div class="title">–õ–∞–º–±–æ</div><div class="price"><span class="star">‚òÖ</span> 3899</div>
      </a>
    </main>

    <div class="nav-spacer" aria-hidden="true" style="height: 20px;"></div>

    <nav class="nav">
      <a class="btn active" href="/">–ö–µ–π—Å—ã</a>
      <a class="btn" href="/crash.html">Crash üöÄ</a>
      <a class="btn" href="/profile/">–ü—Ä–æ—Ñ–∏–ª—å</a>
    </nav>
  </div>

  <script>
  // === –õ–û–ì–ò–ö–ê –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê ===
  function openInfo(e) {
    e.preventDefault(); // –ó–∞–ø—Ä–µ—â–∞–µ–º –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å—Å—ã–ª–∫–∏
    e.stopPropagation(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–±—ã—Ç–∏–µ
    const modal = document.getElementById('infoModal');
    modal.classList.add('open');
    
    // –í–∏–±—Ä–∞—Ü–∏—è
    if(window.Telegram.WebApp.HapticFeedback) {
        window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
    }
  }

  function closeInfo() {
    document.getElementById('infoModal').classList.remove('open');
  }

  // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
  document.getElementById('infoModal').addEventListener('click', function(e) {
    if(e.target === this) closeInfo();
  });


  // === –û–°–ù–û–í–ù–û–ô –°–ö–†–ò–ü–¢ ===
  (async () => {
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    const balEl = document.getElementById('balanceValue');

    // 1. –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø
    try {
        const res = await fetch('/api/user?action=auth', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ initData: tg.initData })
        }).then(r => r.json());

        if (res.ok && res.stars != null) {
            balEl.textContent = res.stars;
        } else {
            balEl.textContent = '0';
        }
    } catch (e) {
        console.error(e);
        balEl.textContent = '?';
    }

    // 2. LIVE –õ–ï–ù–¢–ê
    async function loadLiveFeed() {
      const track = document.getElementById('liveTrack');
      try {
        const drops = await fetch('/api/live').then(r => r.json());
        if(!drops || drops.length === 0) {
           track.innerHTML = '<div style="padding:22px; color:#555; font-size:10px;">–õ–µ–Ω—Ç–∞ –ø—É—Å—Ç–∞</div>';
           return;
        }
        const itemsHtml = drops.map(d => `
          <div class="live-item ${d.is_rare ? 'rare' : ''}">
             <img src="${d.image_url}" onerror="this.src='/assets/logo.png'">
          </div>
        `).join('');
        track.innerHTML = itemsHtml + itemsHtml; 
        track.classList.add('animate');
      } catch(e) {
        track.innerHTML = '<div style="padding:22px; color:#555; font-size:10px;">Offline</div>';
      }
    }
    loadLiveFeed();

  })();
  </script>
</body>
</html>
